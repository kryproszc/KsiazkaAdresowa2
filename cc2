def update_ratios():
    data_list = user_data.reactive_data_paid_list.get()
    if not data_list or data_list[-1] is None:
        user_data.ratio_df_p.set(None)
        user_data.binary_df_p.set(None)
        return

    df = data_list[-1]

    try:
        ratio_df = calculate_ratios_vectorized(df)
        bin_df = create_binary_df(ratio_df)

        user_data.ratio_df_p.set(ratio_df)
        user_data.binary_df_p.set(bin_df)

        if user_data.dev_all_initial.get() is None:
            dev_all = calculator.calculate_dev(df, bin_df, ratio_df)
            user_data.dev_all_initial.set(dev_all)

    except Exception as e:
        show_info_modal(f"❌ Błąd przy przetwarzaniu Paid: {e}", error=True)






if triangle_type == "triangle_paid":
    user_data.reset_paid_state()
    old_data = user_data.reactive_data_paid_list.get()
    user_data.reactive_data_paid_list.set(old_data + [data])
    user_data.current_triangle.set("triangle_paid")
    user_data.dev_all_initial.set(None)

    update_ratios()  # <--- dodajesz to tutaj
