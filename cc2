@reactive.Effect
def update_ratios_incurred():
    data = user_data.reactive_data_incurred_list.get()
    if not data or data[-1] is None:
        user_data.ratio_df_i.set(None)
        user_data.binary_df_i.set(None)
        return

    df = data[-1]

    try:
        ratio_df = calculate_ratios_vectorized(df)
        bin_df = create_binary_df(ratio_df)

        user_data.ratio_df_i.set(ratio_df)
        user_data.binary_df_i.set(bin_df)

        if user_data.dev_all_initial_i.get() is None:
            dev_all = calculator.calculate_dev(df, bin_df, ratio_df)
            user_data.dev_all_initial_i.set(dev_all)

    except Exception:
        show_info_modal("❌ Wystąpił błąd podczas przetwarzania danych – nie można wyliczyć współczynników (Incurred).", error=True)
